$(function(){var t,e;return t=new CannedApp($("#userid").text()),e=new CannedView(t)});var CannedApp;CannedApp=function(){function t(t){this.userid=t,this.color=null,this.initSocket(),this.login(this.userid)}return t.prototype.setListener=function(t){return this.listener=t},t.prototype.chat=function(t){return this.listener.addMessage(this.userid,this.color,t),this.socket.emit("chat",{color:this.color,userid:this.userid,text:t})},t.prototype.typed=function(t){return this.socket.emit("typed",{color:this.color,userid:this.userid,text:t})},t.prototype.login=function(t){return this.socket.emit("login",t)},t.prototype.initSocket=function(){return this.socket=io.connect("http://localhost:3000"),this.socket.on("welcome",function(t){return function(e){var o,n,i,s,r;for(t.color=e.color,t.listener.showColor(t.color),s=e.chat,r=[],n=0,i=s.length;i>n;n++)o=s[n],r.push(t.listener.addMessage(o.userid,o.color,o.text));return r}}(this)),this.socket.on("joined",function(t){return function(e){return t.listener.showJoined(e.userid,e.color)}}(this)),this.socket.on("chat",function(t){return function(e){return t.listener.addMessage(e.userid,e.color,e.text)}}(this)),this.socket.on("typed",function(t){return function(e){return e.userid!==t.userid?t.listener.showTyping(e.userid,e.color,e.text):void 0}}(this))},t.prototype.benchmark=function(){var t,e,o,n,i;for(o=new Date,t=i=1;1e3>=i;t=++i)this.socket.emit("chat",{color:this.color,userid:this.userid,text:"Hello "+t+" and goodbye!"});return n=new Date,e=n.getTime()-o.getTime()},t}();var CannedView;CannedView=function(){function t(t){this.app=t,this.app.setListener(this),this.$compose=$("#compose"),this.$composeText=$("#compose-text"),this.$composeSubmit=$("#compose-submit"),this.$composeOthers=$("#compose-others"),$(".scroll-pane").jScrollPane(),this.$composeSubmit.click(function(t){return function(){var e;return _.isEmpty(t.$composeText.attr("value"))?void 0:(e=t.$composeText.attr("value"),t.app.chat(e),t.$composeText.attr("value",""),t.app.typed(""))}}(this)),this.$composeText.keyup(function(t){return function(e){return 13===e.keyCode?t.$composeSubmit.click():t.app.typed(t.$composeText.attr("value"))}}(this)),$("#benchmark-submit").click(function(t){return function(){var e;return alert("starting benchmark"),e=t.app.benchmark(),alert("Took "+e+"ms")}}(this))}return t.prototype.showColor=function(t){return this.$compose.addClass(t)},t.prototype.addMessage=function(t,e,o){var n,i,s;return s=$("#chat"),i=s.jScrollPane().data("jsp"),n=$("<div class='message'>"+t+": <span class='"+e+"'>"+o+"</span></div>"),i.getContentPane().append(n),i.reinitialise(),i.scrollToElement(n,!1,!0)},t.prototype.showJoined=function(t,e){return this.addMessage(t,"white","<i>"+e+" joined</i>"),this.$composeOthers.append($("<div>").attr("id",t).addClass(e).text(""))},t.prototype.showTyping=function(t,e,o){var n;return n=$("#"+t),0===n.length?this.$composeOthers.append($("<div>").attr("id",t).addClass(e).text(o)):_.isEmpty(o)?(n.text(""),n.hide()):(n.text("> "+o+".."),n.show())},t}();