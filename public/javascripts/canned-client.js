var CannedApp,CannedView;CannedApp=function(){function t(t){this.userid=t,this.color=null,this.initSocket(),this.login(this.userid)}return t.prototype.setListener=function(t){return this.listener=t},t.prototype.chat=function(t){return this.listener.addMessage(this.userid,this.color,t),this.socket.emit("chat",{color:this.color,userid:this.userid,text:t})},t.prototype.typed=function(t){return this.socket.emit("typed",{color:this.color,userid:this.userid,text:t})},t.prototype.login=function(t){return this.socket.emit("login",t)},t.prototype.initSocket=function(){return this.socket=io.connect("http://localhost:3000"),this.socket.on("welcome",function(t){return function(e){var o,i,n,s,r;for(t.color=e.color,t.listener.showColor(t.color),s=e.chat,r=[],i=0,n=s.length;n>i;i++)o=s[i],r.push(t.listener.addMessage(o.userid,o.color,o.text));return r}}(this)),this.socket.on("joined",function(t){return function(e){return t.listener.showJoined(e.userid,e.color)}}(this)),this.socket.on("chat",function(t){return function(e){return t.listener.addMessage(e.userid,e.color,e.text)}}(this)),this.socket.on("typed",function(t){return function(e){return e.userid!==t.userid?t.listener.showTyping(e.userid,e.color,e.text):void 0}}(this))},t.prototype.benchmark=function(){var t,e,o,i,n;for(o=new Date,t=n=1;1e3>=n;t=++n)this.socket.emit("chat",{color:this.color,userid:this.userid,text:"Hello "+t+" and goodbye!"});return i=new Date,e=i.getTime()-o.getTime()},t}(),CannedView=function(){function t(t){this.app=t,this.app.setListener(this),this.$compose=$("#compose"),this.$composeText=$("#compose-text"),this.$composeSubmit=$("#compose-submit"),this.$composeOthers=$("#compose-others"),$(".scroll-pane").jScrollPane(),this.$composeSubmit.click(function(t){return function(){var e;return _.isEmpty(t.$composeText.attr("value"))?void 0:(e=t.$composeText.attr("value"),t.app.chat(e),t.$composeText.attr("value",""),t.app.typed(""))}}(this)),this.$composeText.keyup(function(t){return function(e){return 13===e.keyCode?t.$composeSubmit.click():t.app.typed(t.$composeText.attr("value"))}}(this)),$("#benchmark-submit").click(function(t){return function(){var e;return alert("starting benchmark"),e=t.app.benchmark(),alert("Took "+e+"ms")}}(this))}return t.prototype.showColor=function(t){return this.$compose.addClass(t)},t.prototype.addMessage=function(t,e,o){var i,n,s;return s=$("#chat"),n=s.jScrollPane().data("jsp"),i=$("<div class='message "+e+"'>"+o+"</div>"),n.getContentPane().append(i),n.reinitialise(),n.scrollToElement(i,!1,!0)},t.prototype.showJoined=function(t,e){return this.addMessage(t,"white","<i>"+e+" joined</i>"),this.$composeOthers.append($("<div>").attr("id",t).addClass(e).text(""))},t.prototype.showTyping=function(t,e,o){var i;return i=$("#"+t),0===i.length?this.$composeOthers.append($("<div>").attr("id",t).addClass(e).text(o)):i.text(_.isEmpty(o)?"":"> "+o+"..")},t}(),$(function(){var t,e;return t=new CannedApp($("#userid").text()),e=new CannedView(t)});