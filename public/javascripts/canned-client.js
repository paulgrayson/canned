$(function(){var t,e;return t=new CannedApp($("#userid").text(),$("#twitterId").text()),e=new CannedView(t)});var CannedApp;CannedApp=function(){function t(t,e){this.userid=t,this.twitterId=e,this.color=null,this.initSocket(),this.login(this.userid,this.twitterId)}return t.prototype.setListener=function(t){return this.listener=t},t.prototype.chat=function(t){return this.listener.addMessage(this.userid,this.twitterId,this.color,t),this.socket.emit("chat",{color:this.color,userid:this.userid,twitterId:this.twitterId,text:t})},t.prototype.typed=function(t){return this.socket.emit("typed",{color:this.color,userid:this.userid,text:t,twitterId:this.twitterId})},t.prototype.login=function(t,e){return this.socket.emit("login",t,e)},t.prototype.initSocket=function(){return this.socket=io.connect("http://localhost:3000"),this.socket.on("welcome",function(t){return function(e){var o,i,s,n,r;for(t.color=e.color,t.listener.showColor(t.color),n=e.chat,r=[],i=0,s=n.length;s>i;i++)o=n[i],r.push(t.listener.addMessage(o.userid,o.twitterId,o.color,o.text));return r}}(this)),this.socket.on("joined",function(t){return function(e){return t.listener.showJoined(e.userid,e.twitterId,e.color)}}(this)),this.socket.on("chat",function(t){return function(e){return t.listener.addMessage(e.userid,e.twitterId,e.color,e.text)}}(this)),this.socket.on("typed",function(t){return function(e){return e.userid!==t.userid?t.listener.showTyping(e.userid,e.twitterId,e.color,e.text):void 0}}(this))},t}();var CannedView;CannedView=function(){function t(t){this.app=t,this.app.setListener(this),this.$compose=$("#compose"),this.$composeText=$("#compose-text"),this.$composeSubmit=$("#compose-submit"),this.$composeOthers=$("#compose-others"),$(".scroll-pane").jScrollPane(),this.$composeSubmit.click(function(t){return function(){var e;return _.isEmpty(t.$composeText.attr("value"))?void 0:(e=t.$composeText.attr("value"),t.app.chat(e),t.$composeText.attr("value",""),t.app.typed(""))}}(this)),this.$composeText.keyup(function(t){return function(e){return 13===e.keyCode?t.$composeSubmit.click():t.app.typed(t.$composeText.attr("value"))}}(this))}return t.prototype.showColor=function(t){return this.$compose.addClass(t)},t.prototype.addMessage=function(t,e,o,i){var s,n,r;return r=$("#chat"),n=r.jScrollPane().data("jsp"),s=$("<div class='message'>"+e+": <span class='"+o+"'>"+i+"</span></div>"),n.getContentPane().append(s),n.reinitialise(),n.scrollToElement(s,!1,!0)},t.prototype.showJoined=function(t,e){return this.addMessage(t,e,"white","<i>"+e+" joined</i>")},t.prototype.showTyping=function(t,e,o,i){var s;return s=$("#"+t),0===s.length?this.$composeOthers.append($("<div>").attr("id",t).addClass(o).addClass("message").text(i)):_.isEmpty(i)?(s.text(""),s.hide()):(s.text(""+e+": "+i+".."),s.show())},t}();